<!DOCTYPE html>
<html>

<head>
    <title>BREADS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/fontawesome/css/all.css">
    <link rel="stylesheet" href="/stylesheets/bootstrap.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="/javascripts/jquery-3.6.1.js"></script>
    <link rel="shortcut icon" href="#">

  
</head>

<body>
    <div class="container">
        <div class="card-header">
            <h1>Varian</h1>
            <table class="table table-striped">
                <thead id="sorting">
                    <tr>
                        <th> Barcode </th>
                        <th> ID Barang</th>
                        <th> Nama Barang</th>
                        <th> Nama Varian</th>
                        <th> Stock</th>
                        <th> Pictures</th>
                        <th> Harga Jual</th>
                        <th> Harga Beli</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

            <div class="row">
                <div class="col-6">
                    <ul aria-label="Page navigation" id="pagination">
                    </ul>
                </div>
                <div class="col-6">
                    <div class="row">

                    </div>
                </div>

            </div>
            <form id="form-tambah">
                <input type="hidden" id="id_varian" name="id" value="">
                <div class="card">
                    <div class="card-header">
                        <h2>Varian Tambah</h2>
                    </div>

                    <div class="card-body">

                        <div class="row mb-3">
                            <label for="barcode" class="col-sm-2 col-form-label">ID Varian</label>
                            <div class="col-sm-10">
                              <input type="text" class="form-control" id="barcode" placeholder="ID varian">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="nama_varian" class="col-sm-2 col-form-label">Nama varian</label>
                            <div class="col-sm-10">
                              <input type="text" class="form-control" id="nama_varian" placeholder="Nama varian">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="stock" class="col-sm-2 col-form-label">Stock</label>
                            <div class="col-sm-10">
                              <input type="integer" class="form-control" id="stock" placeholder="Stok varian">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="buy_price" class="col-sm-2 col-form-label">Harga_beli</label>
                            <div class="col-sm-10">
                              <input type="integer" class="form-control" id="buy_price" placeholder="Buy varian">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="sell_price" class="col-sm-2 col-form-label">Harga_jual</label>
                            <div class="col-sm-10">
                              <input type="integer" class="form-control" id="sell_price" placeholder="Sell varian">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label for="id_barang" class="col-sm-2 col-form-label">ID Barang</label>
                            <div class="col-sm-10">
                              <input class="form-control" id="id_barang" name="ID Barang" placeholder="ID Barang">
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="button" id="reset-form-search" class="btn btn-warning">reset</button>
                    </div>
                </div>
            </form>
        </div>
        <form id="form-edit">
            <input type="hidden" id="id_varianedit" name="id" value="">
            <div class="card">
                <div class="card-header">
                    <h2>Edit varian Barang</h2>
                </div>

                <div class="card-body">

                    <div class="row mb-3">
                        <label for="nama_varian" class="col-sm-2 col-form-label">Nama varian</label>
                        <div class="col-sm-10">
                          <input type="text" class="form-control" id="nama_varianedit" placeholder="Nama varian">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="nomor_hp" class="col-sm-2 col-form-label">Nomor HP</label>
                        <div class="col-sm-10">
                          <input type="tel" class="form-control" id="nomor_hpedit" pattern="[0-9]{4}-[0-9]{4}-[0-9]{4}"
                          placeholder="08xx-xxxx-xxxx">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="alamat_varian" class="col-sm-2 col-form-label">Alamat varian</label>
                        <div class="col-sm-10">
                          <textarea class="form-control" id="alamat_varianedit" rows="4"></textarea>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" id="reset-form-edit" class="btn btn-warning">reset</button>
                </div>
            </div>
        </form>
    </div>
</body>
<script>
    const readData = () => {
      $.ajax({
        method: "GET",
        url: "http://localhost:3000/varian",
        dataType: "json",
        headers: {
          json: true
        }
      }).done(function (data) {
  
        let html = ''
        data.forEach((item, index) => {
          html += `
          <tr>
            <td>${item.barcode}</td>
            <td>${item.id_barang}</td>
            <td>${item.nama_barang}</td>
            <td>${item.name_varian}</td>
            <td>${item.stock}</td>
            <td> <img src="../public/images/${item.pictures}" alt="image" /> </td>
            <td>${item.buy_price}</td>
            <td>${item.sell_price}</td>
            <td>
              <button type="button" class="btn btn-success btn-icon-text" id_data="${item.barcode}"><i class="mdi mdi-file-check btn-icon-append"></i></button>
              <button type="button" class="btn btn-danger btn-icon-delete" id_data="${item.barcode}"><i class="mdi mdi-trash-can btn-icon-append"></i></button>
            </td>
          </tr>
          `
        });
        $('table tbody').html(html)
      }).fail(function (err) {
        console.log("error", err)
        alert('gagal jquery')
      })
    }
  
    const readSelect = () => {
      $.ajax({
        method: "GET",
        url: "http://localhost:3000/varian/select",
        dataType: "json",
        headers: {
          json: true
        }
      }).done(function (rows) {
        console.log(rows)
  
        let html = ''
        rows.forEach((item, index) => {
          html += `
          <option value="${item.id_barang}">
           ${item.id_barang} - ${item.nama_barang}
          </option>
          `
        });
        $('form select').html(html)
      }).fail(function (err) {
        console.log("error", err)
        alert('gagal jquery tambah salah satu ID')
      })
    }
  
    const saveData = (id_varian, nomor_hp, nama_varian, alamat_varian) => {
      $.ajax({
        method: "POST",
        url: `http://localhost:3000/varian`,
        dataType: "json",
        headers: {
          json: true
        },
        data: { nomor_hp, nama_varian, alamat_varian }
      }).done(function (response) {
        readData()
        $("#form-tambah").trigger("reset");
      }).fail(function (err) {
        alert('gagal pake jquery save')
      })
    }
    const saveEdit = (id_varian, nama_varian, alamat_varian, nomor_hp) => {
      $.ajax({
        method: "PUT",
        url: `http://localhost:3000/varian/${id_varian}`,
        dataType: "json",
        headers: {
          json: true
        },
        data: { nama_varian, alamat_varian, nomor_hp }
      }).done(function (response) {
        readData()
        $('#id_varianedit').val('')
        $("#form-edit").trigger("reset");
      }).fail(function (err) {
        alert('gagal pake jquery save edit')
      })
    }
  
    const editData = (id) => {
      $.ajax({
        method: "GET",
        url: `http://localhost:3000/varian/${id}`,
        dataType: "json",
        headers: {
          json: true
        }
      }).done(function (data) {
        console.log(data)
        $('#id_varianedit').val(data[0].id_varian)
        $('#nama_varianedit').val(data[0].nama)
        $('#alamat_varianedit').val(data[0].alamat)
        $('#nomor_hpedit').val(data[0].telp)
      }).fail(function (err) {
        alert('gagal pake jquery')
      })
    }
  
    const deleteData = (id) => {
      $.ajax({
        method: "DELETE",
        url: `http://localhost:3000/varian/${id}`,
        dataType: "json",
        headers: {
          json: true
        }
  
      }).done(function (response) {
        readData()
      }).fail(function (err) {
        alert('gagal pake jquery')
      })
    }
  
    $(document).ready(function () {
      readData()
      readSelect()
  
      $('#form-tambah').submit(function (event) {
        event.preventDefault();
        const id_varian = $('#id_varian').val()
        const nomor_hp = $('#nomor_hp').val()
        const nama_varian = $('#nama_varian').val()
        const alamat_varian = $('#alamat_varian').val()
        saveData(id_varian, nomor_hp, nama_varian, alamat_varian)
      })
  
      $('#form-edit').submit(function (event) {
        event.preventDefault();
        const id_varian = $('#id_varianedit').val()
        const nama_varian = $('#nama_varianedit').val()
        const alamat_varian = $('#alamat_varianedit').val()
        const nomor_hp = $('#nomor_hpedit').val()
        saveEdit(id_varian, nama_varian, alamat_varian, nomor_hp)
      })
  
      $('table tbody').on('click', '.btn-icon-text', function () {
        const id = $(this).attr('id_data')
        editData(id)
  
      })
  
      $('table tbody').on('click', '.btn-icon-delete', function () {
        const id = $(this).attr('id_data')
        deleteData(id)
      })
  
      $('#reset-form-tambah').click(function () {
        $("#form-tambah").trigger("reset");
        readData()
      })
  
      $('#reset-form-edit').click(function () {
        $("#form-edit").trigger("reset");
        readData()
      })
  
  
    })
  </script>
  
  </html>






  
